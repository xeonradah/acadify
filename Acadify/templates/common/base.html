<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Acadify - Academic Record Management System for Norzagaray College">
    <title>{% block title %}Acadify - Academic Record Management{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            },
            darkMode: 'class'
        }
    </script>
    
    <style>
        /* Alpine.js x-cloak - Hide elements until Alpine is ready */
        [x-cloak] { display: none !important; }
        
        /* Subtle hover animations */
        .nav-link { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .nav-link:hover { transform: translateX(2px); }
        
        
        /* Flat button styling */
        .btn-alt {
            width: 2.5rem !important;
            height: 2.5rem !important;
            border-radius: 0 !important;
            background-color: transparent !important;
            border: none !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            transition: background-color 0.2s !important;
        }
        
        .btn-alt:hover {
            background-color: transparent !important;
        }
        
        .dark .btn-alt {
            background-color: transparent !important;
            border: none !important;
        }
        
        .dark .btn-alt:hover {
            background-color: transparent !important;
        }
        
        /* Responsive sidebar behavior - Auto-hide on small screens */
        @media (max-width: 1023px) {
            /* Ensure sidebar is hidden by default on mobile and tablet */
            aside {
                transform: translateX(-100%) !important;
            }
            
            /* Show sidebar when opened */
            aside.translate-x-0 {
                transform: translateX(0) !important;
            }
        }
        
        @media (min-width: 1024px) {
            /* Always show sidebar on desktop */
            aside {
                transform: translateX(0) !important;
            }
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen bg-base-100 font-sans antialiased transition-colors duration-200" data-theme="light">
    <div x-data="{ sidebarOpen: false }" class="flex flex-col min-h-screen">
        {% set current_path = request.path %}
        <!-- Navbar - Clean Minimal Design - Single Line -->
        <div class="navbar bg-base-200/50 border-b border-base-300 sticky top-0 z-30 px-3 sm:px-4 lg:px-6 h-16 backdrop-blur-sm">
                <!-- Mobile/Tablet: Menu Toggle -->
                <div class="flex-none lg:hidden">
                    <button class="btn-alt" 
                            @click="sidebarOpen = !sidebarOpen">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-700 dark:text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" x2="21" y1="12" y2="12"/>
                            <line x1="3" x2="21" y1="6" y2="6"/>
                            <line x1="3" x2="21" y1="18" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- Logo -->
                <div class="flex-1 flex items-center gap-3">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="w-10 h-10 object-contain">
                    <div>
                        <h2 class="font-semibold text-lg">Acadify</h2>
                        <p class="text-xs text-base-content/60">Academic Management</p>
                    </div>
                </div>

                <!-- Right Side -->
                <div class="flex-none flex items-center gap-3">
                    <!-- User Info -->
                        <div class="hidden md:flex flex-col items-end">
                        <span class="text-sm font-semibold">
                            {{ current_user.first_name }}
                            {% if current_user.middle_name %} {{ current_user.middle_name }}{% endif %}
                            {{ current_user.last_name }}
                            {% if current_user.suffix %} {{ current_user.suffix }}{% endif %}
                        </span>
                        <span class="text-xs text-base-content/60">
                            {% if current_user.role == 'student' %}Student
                            {% elif current_user.role == 'instructor' %}Instructor
                            {% elif current_user.role == 'registrar' %}Registrar
                            {% elif current_user.role == 'dean' %}Dean
                            {% elif current_user.role == 'mis_it' %}MIS/IT
                                    {% endif %}
                                </span>
                            </div>


                    <!-- User Menu -->
                        {% if current_user.is_authenticated %}
                        <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn-alt relative">
                                <div class="avatar placeholder">
                                <div class="w-8 h-8 rounded-full bg-primary text-primary-content">
                                    <span class="text-sm font-medium">{{ current_user.first_name[0] }}{{ current_user.last_name[0] }}</span>
                                </div>
                            </div>
                        </div>
                        <ul tabindex="0" class="menu dropdown-content mt-3 z-50 p-2 dropdown-refined bg-base-100 rounded-box w-52 border border-base-300">
                            <li class="menu-title md:hidden px-4 py-2">
                                <span class="text-sm font-semibold">
                                    {{ current_user.first_name }}
                                    {% if current_user.middle_name %} {{ current_user.middle_name }}{% endif %}
                                    {{ current_user.last_name }}
                                    {% if current_user.suffix %} {{ current_user.suffix }}{% endif %}
                                </span>
                                <span class="text-xs opacity-60">
                                    {% if current_user.role == 'student' %}Student
                                    {% elif current_user.role == 'instructor' %}Instructor
                                    {% elif current_user.role == 'registrar' %}Registrar
                                    {% elif current_user.role == 'dean' %}Dean
                                    {% elif current_user.role == 'mis_it' %}MIS/IT
                                    {% endif %}
                                            </span>
                                </li>
                                <li>
                                <a>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                    Profile
                                    </a>
                                </li>
                                <li>
                                <a onclick="settingsModal.showModal()">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    Settings
                                    </a>
                                </li>
                            <div class="divider my-0"></div>
                            <li>
                                <a href="{{ url_for('logout') }}" class="text-error" onclick="sessionStorage.removeItem('welcomeDismissed')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16 17 21 12 16 7"/>
                                        <line x1="21" x2="9" y1="12" y2="12"/>
                                    </svg>
                                    Logout
                                    </a>
                                </li>
                            </ul>
                    </div>
                        {% else %}
                        <!-- Anonymous User - Show Login Button -->
                        <div class="flex items-center gap-2">
                            <a href="{{ url_for('login') }}" class="btn btn-primary btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                                    <polyline points="10 17 15 12 10 7"/>
                                    <line x1="15" x2="3" y1="12" y2="12"/>
                                </svg>
                                Login
                            </a>
                        </div>
                        {% endif %}
                </div>
            </div>

        <!-- Main Content Area -->
        <div class="flex-1">
            {% if current_user.is_authenticated %}
            <!-- Sidebar -->
            <aside class="w-72 bg-base-100 border-r border-base-300 h-screen flex flex-col fixed z-20 transition-transform duration-300 top-16" 
                   :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0">
                <!-- Mobile/Tablet Overlay -->
                <div class="fixed inset-0 bg-black bg-opacity-50 z-10 lg:hidden" 
                     x-show="sidebarOpen" 
                     @click="sidebarOpen = false"
                     x-transition:enter="transition-opacity ease-linear duration-300"
                     x-transition:enter-start="opacity-0"
                     x-transition:enter-end="opacity-100"
                     x-transition:leave="transition-opacity ease-linear duration-300"
                     x-transition:leave-start="opacity-100"
                     x-transition:leave-end="opacity-0"></div>
                <!-- Sidebar Navigation -->
                <nav class="flex-1 px-3 py-6 space-y-1 overflow-y-auto">
                    {% if current_user.is_authenticated %}
                        {% if current_user.role == 'student' %}
                        <!-- Student Menu -->
                        <div class="divider my-0 text-xs uppercase tracking-wider opacity-50">Student</div>
                                <a href="{{ url_for('dashboard') }}" 
                           class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path in [url_for('dashboard'), '/student/dashboard'] else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                                </svg>
                                <span>Dashboard</span>
                        </a>
                                <a href="{{ url_for('student_grades') }}" 
                           class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {% if current_path == '/student/grades' %}bg-primary text-primary-content{% else %}hover:bg-base-200{% endif %}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" x2="8" y1="13" y2="13"/>
                                <line x1="16" x2="8" y1="17" y2="17"/>
                                <polyline points="10 9 9 9 8 9"/>
                            </svg>
                            <span>My Grades</span>
                        </a>
                        {% elif current_user.role == 'instructor' %}
                        <!-- Instructor Menu -->
                        <div class="divider my-2 text-xs uppercase tracking-wider opacity-50">Instructor</div>
                        <a href="{{ url_for('dashboard') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path in [url_for('dashboard'), '/instructor/dashboard'] else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                                </svg>
                                <span>Dashboard</span>
                        </a>
                        
                        {% elif current_user.role == 'registrar' %}
                        <!-- Registrar Menu -->
                        <div class="divider my-2 text-xs uppercase tracking-wider opacity-50">Registrar</div>
                        <a href="{{ url_for('dashboard') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path in [url_for('dashboard'), '/registrar/dashboard'] else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                            </svg>
                            <span>Dashboard</span>
                        </a>
                        <a href="{{ url_for('instructor_selection') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('instructor_selection') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <span>Instructor Access</span>
                        </a>
                        <a href="{{ url_for('registrar_subcreate') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('registrar_subcreate') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14m7-7H5"/>
                            </svg>
                            <span>Create Subject</span>
                        </a>
                        <a href="{{ url_for('assign_subject') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('assign_subject') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect width="20" height="14" x="2" y="7" rx="2" ry="2"/>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                            </svg>
                            <span>Assign Subjects</span>
                        </a>
                        <a href="{{ url_for('registrar_promotion_report') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('registrar_promotion_report') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                            </svg>
                            <span>Promotion Report</span>
                        </a>
                        <a href="{{ url_for('registrar_grade_history') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('registrar_grade_history') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 3v18h18"/>
                                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                            </svg>
                            <span>Grade History</span>
                        </a>
                        <a href="{{ url_for('enrollment_dashboard') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('enrollment_dashboard') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            <span>Enrollment Management</span>
                        </a>
                        {% elif current_user.role == 'dean' %}
                        <!-- Dean Menu -->
                        <div class="divider my-2 text-xs uppercase tracking-wider opacity-50">Dean</div>
                        <a href="{{ url_for('dashboard') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path in [url_for('dashboard'), '/dean/dashboard'] else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                                </svg>
                                <span>Dashboard</span>
                        </a>
                        <a href="{{ url_for('registrar_promotion_report') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('registrar_promotion_report') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                            </svg>
                            <span>Promotion Report</span>
                        </a>
                        {% elif current_user.role == 'mis_it' %}
                        <!-- MIS/IT Menu -->
                        <div class="divider my-2 text-xs uppercase tracking-wider opacity-50">MIS/IT</div>
                        <a href="{{ url_for('dashboard') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path in [url_for('dashboard'), '/misit/dashboard'] else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                <polyline points="9 22 9 12 15 12 15 22"/>
                                </svg>
                                    <span>Dashboard</span>
                                </a>
                        <a href="{{ url_for('create_account_page') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('create_account_page') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <line x1="19" x2="19" y1="8" y2="14"/>
                                <line x1="22" x2="16" y1="11" y2="11"/>
                            </svg>
                                    <span>Create Staff Account</span>
                                </a>
                        <a href="{{ url_for('misit_create_student_account_page') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('misit_create_student_account_page') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                            </svg>
                                    <span>Create Student Account</span>
                                </a>
                        <a href="{{ url_for('grade_encoding_schedule') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('grade_encoding_schedule') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                                <line x1="16" x2="16" y1="2" y2="6"/>
                                <line x1="8" x2="8" y1="2" y2="6"/>
                                <line x1="3" x2="21" y1="10" y2="10"/>
                            </svg>
                            <span>Grade Schedule</span>
                        </a>
                        <a href="{{ url_for('audit_logs') }}" class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium {{ 'bg-primary text-primary-content' if current_path == url_for('audit_logs') else 'hover:bg-base-200' }}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.3-4.3"/>
                            </svg>
                            <span>Audit Logs</span>
                        </a>
                        {% endif %}
                    {% else %}
                        <!-- Login for Non-Authenticated Users -->
                        <div class="divider my-2 text-xs uppercase tracking-wider opacity-50">Welcome</div>
                            <a href="{{ url_for('login') }}" 
                           class="nav-link flex items-center gap-3 rounded-lg px-4 py-3 text-sm font-medium hover:bg-base-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                                <polyline points="10 17 15 12 10 7"/>
                                <line x1="15" x2="3" y1="12" y2="12"/>
                                </svg>
                                <span>Login</span>
                            </a>
                    {% endif %}
                </nav>
            </aside>
            {% endif %}
            
            <!-- Page Content -->
            <main class="p-4 lg:p-6 overflow-auto {% if current_user.is_authenticated %}lg:ml-72{% endif %}">
                <!-- Flash Messages - Alpine.js for smooth close -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-6 space-y-3">
                            {% for category, message in messages %}
                                <div x-data="{ show: true }" x-show="show" x-transition 
                                     class="alert {{ 'alert-success' if category == 'success' else ('alert-error' if category == 'error' else 'alert-info') }} shadow-refined-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                        {% if category == 'success' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        {% elif category == 'error' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        {% else %}
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        {% endif %}
                                    </svg>
                                    <span>{{ message }}</span>
                                    <button @click="show = false" class="btn btn-ghost btn-sm btn-circle">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
                
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- Settings Modal -->
    <dialog id="settingsModal" class="modal">
        <div class="modal-box max-w-md modal-refined">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-primary/10 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg">Settings</h3>
                        <p class="text-sm text-base-content/60">Customize your experience</p>
                    </div>
                </div>
                <button onclick="settingsModal.close()" class="btn btn-ghost btn-sm btn-circle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Appearance Settings -->
            <div class="space-y-6">
                <div>
                    <h4 class="font-semibold text-base mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="4"/>
                            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
                        </svg>
                        Appearance
                    </h4>
                    
                    <div class="space-y-3">
                        <!-- Light Mode Option -->
                        <label class="flex items-center gap-4 p-4 rounded-lg border border-base-300 hover:bg-base-200 cursor-pointer transition-colors">
                            <div class="flex items-center gap-3 flex-1">
                                <div class="p-2 bg-yellow-100 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="4"/>
                                        <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="font-medium">Light Mode</div>
                                    <div class="text-sm text-base-content/60">Clean and bright interface</div>
                                </div>
                            </div>
                            <input type="radio" name="theme-settings-modal" class="radio radio-primary" value="light" />
                        </label>

                        <!-- Dark Mode Option -->
                        <label class="flex items-center gap-4 p-4 rounded-lg border border-base-300 hover:bg-base-200 cursor-pointer transition-colors">
                            <div class="flex items-center gap-3 flex-1">
                                <div class="p-2 bg-slate-100 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="font-medium">Dark Mode</div>
                                    <div class="text-sm text-base-content/60">Easy on the eyes</div>
                                </div>
                            </div>
                            <input type="radio" name="theme-settings-modal" class="radio radio-primary" value="dark" />
                        </label>
                    </div>
                </div>

                <!-- Quick Toggle -->
                <div class="divider">Quick Toggle</div>
                <div class="flex items-center justify-between p-4 bg-base-200 rounded-lg">
                    <div class="flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        <span class="font-medium">Theme Toggle</span>
                    </div>
                    <label class="swap swap-rotate">
                        <input type="checkbox" class="theme-controller-modal" />
                        <svg class="swap-on w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="4"/>
                            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/>
                        </svg>
                        <svg class="swap-off w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                        </svg>
                    </label>
                </div>
            </div>

            <div class="modal-action">
                <button onclick="settingsModal.close()" class="btn btn-primary">Done</button>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button onclick="settingsModal.close()">close</button>
        </form>
    </dialog>

    <!-- JavaScript -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    
    <!-- Theme Toggle Script -->
    <script>
        // Theme management with smooth transitions
        (function() {
            const STORAGE_KEY = 'acadify-theme';
            
            // Get saved theme or default to light
            function getSavedTheme() {
                return localStorage.getItem(STORAGE_KEY) || 'light';
            }
            
            // Apply theme to document
            function applyTheme(theme, withTransition = false) {
                // Add transition class if requested
                if (withTransition) {
                    document.documentElement.classList.add('theme-transition');
                    setTimeout(() => {
                        document.documentElement.classList.remove('theme-transition');
                    }, 300);
                }
                
                // Apply theme
                document.documentElement.setAttribute('data-theme', theme);
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem(STORAGE_KEY, theme);
                
                // Update meta theme color for mobile browsers
                let metaThemeColor = document.querySelector('meta[name="theme-color"]');
                if (!metaThemeColor) {
                    metaThemeColor = document.createElement('meta');
                    metaThemeColor.name = 'theme-color';
                    document.head.appendChild(metaThemeColor);
                }
                metaThemeColor.content = theme === 'dark' ? '#1f2937' : '#ffffff';
            }
            
            // Update all theme controls to match current theme
            function updateAllThemeControls(theme) {
                // Update modal toggle
                const modalToggle = document.querySelector('.theme-controller-modal');
                if (modalToggle) {
                    modalToggle.checked = theme === 'dark';
                }
                
                // Update modal radio buttons
                const modalRadios = document.querySelectorAll('input[name="theme-settings-modal"]');
                modalRadios.forEach(radio => {
                    radio.checked = radio.value === theme;
                });
            }
            
            // Toggle theme
            function toggleTheme() {
                const currentTheme = getSavedTheme();
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                applyTheme(newTheme, true); // Enable transition for user-triggered changes
                
                // Update all theme controls
                updateAllThemeControls(newTheme);
                
                // Send to server (non-blocking)
                fetch('/api/toggle-theme', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ theme: newTheme })
                }).catch(err => console.log('Theme sync failed:', err));
            }
            
            // Initialize theme on page load
            document.addEventListener('DOMContentLoaded', function() {
                const savedTheme = getSavedTheme();
                applyTheme(savedTheme, false); // No transition on initial load
                
                // Setup settings modal theme selection
                const settingsModalRadios = document.querySelectorAll('input[name="theme-settings-modal"]');
                settingsModalRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        if (this.checked) {
                            applyTheme(this.value, true);
                            // Update all other theme controls
                            updateAllThemeControls(this.value);
                            // Send to server (non-blocking)
                            fetch('/api/toggle-theme', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ theme: this.value })
                            }).catch(err => console.log('Theme sync failed:', err));
                        }
                    });
                });
                
                // Setup modal theme toggle
                const modalToggle = document.querySelector('.theme-controller-modal');
                if (modalToggle) {
                    modalToggle.addEventListener('change', function() {
                        const newTheme = this.checked ? 'dark' : 'light';
                        applyTheme(newTheme, true);
                        updateAllThemeControls(newTheme);
                        // Send to server (non-blocking)
                        fetch('/api/toggle-theme', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ theme: newTheme })
                        }).catch(err => console.log('Theme sync failed:', err));
                    });
                }
                
                // Update all theme controls based on current theme
                const currentTheme = getSavedTheme();
                updateAllThemeControls(currentTheme);
            });
            
            // Apply theme immediately (before DOMContentLoaded to prevent flash)
            applyTheme(getSavedTheme(), false);
            
            // Add CSS for smooth transitions
            const style = document.createElement('style');
            style.textContent = `
                .theme-transition,
                .theme-transition *,
                .theme-transition *:before,
                .theme-transition *:after {
                    transition: background-color 0.3s ease, 
                                color 0.3s ease, 
                                border-color 0.3s ease !important;
                }
            `;
            document.head.appendChild(style);
        })();
        
        
        // Page initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-close sidebar when resizing to desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 1024) {
                    // Close sidebar on desktop
                    const sidebarToggle = document.querySelector('[x-data*="sidebarOpen"]');
                    if (sidebarToggle && sidebarToggle._x_dataStack) {
                        sidebarToggle._x_dataStack[0].sidebarOpen = false;
                    }
                }
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>