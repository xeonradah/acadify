{% extends "common/base.html" %}

{% block title %}Assign Subject - Acadify{% endblock %}

{% block content %}
<section class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl shadow-refined-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="20" height="14" x="2" y="7" rx="2" ry="2"/>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-base-content tracking-tight">Assign Subjects</h1>
                    <p class="text-base-content/60 mt-1">Manage instructor assignments</p>
                </div>
            </div>
            <button id="refreshBtn" class="btn btn-outline">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                    <path d="M16 16h5v5"/>
                </svg>
                Refresh
            </button>
            </div>

        <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="mb-8 space-y-3">
                    {% for category, message in messages %}
                        <div class="alert {{ 'alert-success' if category == 'success' else ('alert-error' if category == 'error' else 'alert-info') }} shadow-refined-light">
                            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                {% if category == 'success' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% elif category == 'error' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% endif %}
                            </svg>
                                <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endwith %}

            <!-- Assignment Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Total Subjects -->
            <div class="stats shadow-refined-light">
                    <div class="stat">
                        <div class="stat-figure text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                        </div>
                        <div class="stat-title">Total Subjects</div>
                        <div class="stat-value text-primary">{{ subjects|length }}</div>
                        <div class="stat-desc">All registered subjects</div>
                    </div>
                </div>
                
            <!-- Assigned Subjects -->
            <div class="stats shadow-refined-light">
                    <div class="stat">
                        <div class="stat-figure text-success">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        </div>
                        <div class="stat-title">Assigned</div>
                        <div class="stat-value text-success">{{ class_assignments|length }}</div>
                        <div class="stat-desc">Section assignments</div>
                    </div>
                </div>

            <!-- Unassigned Subjects -->
            <div class="stats shadow-refined-light">
                    <div class="stat">
                        <div class="stat-figure text-warning">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        </div>
                        <div class="stat-title">Unassigned</div>
                        <div class="stat-value text-warning">{{ subjects|length - class_assignments|length }}</div>
                        <div class="stat-desc">Subjects without assignments</div>
                    </div>
                </div>
            </div>

            <!-- Assignment Form -->
            <div class="card bg-base-100 shadow-refined-medium mb-8">
                    <div class="card-body">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-secondary/10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-secondary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <line x1="19" x2="19" y1="8" y2="14"/>
                                <line x1="22" x2="16" y1="11" y2="11"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="card-title">Assign Subject</h2>
                            <p class="text-sm opacity-60">Assign instructors to subjects by section and academic year</p>
                        </div>
                    </div>
                    
                        <form method="POST" action="{{ url_for('assign_subject') }}" class="space-y-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Subject Selection -->
                        <div class="form-control">
                            <label class="label" for="subject_id">
                                <span class="label-text font-semibold">Subject</span>
                                </label>
                            <select name="subject_id" id="subject_id" class="select select-bordered" required onchange="showSubjectDetails()">
                                    <option value="">Select a subject</option>
                                    {% for subject in subjects %}
                                        <option value="{{ subject.id }}" 
                                                data-department="{{ subject.department }}"
                                                data-year="{{ subject.year_level }}"
                                                data-semester="{{ subject.semester }}"
                                                data-units="{{ subject.units }}">
                                            {{ subject.subject_code }} - {{ subject.subject_name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Instructor Selection -->
                            <div class="form-control">
                                <label class="label" for="instructor_id">
                                    <span class="label-text font-semibold">Instructor</span>
                                </label>
                                <select name="instructor_id" id="instructor_id" class="select select-bordered" required>
                                    <option value="">Select an instructor</option>
                                    {% for instructor in instructors %}
                                        <option value="{{ instructor.id }}" data-department="{{ instructor.department }}">
                                            {{ instructor.first_name }} {{ instructor.last_name }} ({{ instructor.department }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Section -->
                            <div class="form-control">
                                <label class="label" for="section">
                                    <span class="label-text font-semibold">Section</span>
                                </label>
                                <select name="section" id="section" class="select select-bordered" required>
                                    <option value="">Select a section</option>
                                    {% for section in sections %}
                                        <option value="{{ section }}">{{ section }}</option>
                                    {% endfor %}
                                    {% if not sections %}
                                        <option value="" disabled>No sections available - Create students first</option>
                                    {% endif %}
                                </select>
                            </div>

                            <!-- Academic Year -->
                            <div class="form-control">
                                <label class="label" for="school_year">
                                    <span class="label-text font-semibold">Academic Year</span>
                                </label>
                                <div class="join w-full">
                                    <select name="school_year" id="school_year" class="select select-bordered join-item flex-1" required>
                                        <option value="">Select academic year</option>
                                        <option value="2025-2026" selected>2025-2026</option>
                                        <option value="2026-2027">2026-2027</option>
                                    </select>
                                    <button type="button" onclick="openAddAcademicYearModal()" class="btn btn-outline join-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"/>
                                            <line x1="5" y1="12" x2="19" y2="12"/>
                                        </svg>
                                        Add Year
                                    </button>
                                </div>
                            </div>

                            <!-- Schedule Time -->
                            <div class="form-control">
                                <label class="label" for="schedule_time">
                                    <span class="label-text font-semibold">Schedule Time</span>
                                </label>
                                <input type="text" name="schedule_time" id="schedule_time" 
                                       class="input input-bordered" 
                                       placeholder="8:00 AM - 11:00 AM"
                                       pattern="[0-9]{1,2}:[0-9]{2} [AP]M - [0-9]{1,2}:[0-9]{2} [AP]M">
                                <label class="label">
                                    <span class="label-text-alt">Format: 8:00 AM - 11:00 AM</span>
                                </label>
                            </div>

                            <!-- Schedule Day -->
                            <div class="form-control">
                                <label class="label" for="schedule_day">
                                    <span class="label-text font-semibold">Schedule Day</span>
                                </label>
                                <select name="schedule_day" id="schedule_day" class="select select-bordered">
                                    <option value="">Select a day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                </select>
                            </div>

                            <!-- Room -->
                            <div class="form-control">
                                <label class="label" for="room">
                                    <span class="label-text font-semibold">Room</span>
                                </label>
                                <div class="join w-full">
                                    <select name="room" id="room" class="select select-bordered join-item flex-1">
                                        <option value="">Select a room</option>
                                        <option value="Room 101">Room 101</option>
                                        <option value="Room 102">Room 102</option>
                                        <option value="Room 201">Room 201</option>
                                        <option value="Room 202">Room 202</option>
                                        <option value="Computer Lab 1">Computer Lab 1</option>
                                        <option value="Computer Lab 2">Computer Lab 2</option>
                                        <option value="Library">Library</option>
                                        <option value="Auditorium">Auditorium</option>
                                    </select>
                                    <button type="button" onclick="openAddRoomModal()" class="btn btn-outline join-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"/>
                                            <line x1="5" y1="12" x2="19" y2="12"/>
                                        </svg>
                                        Add Room
                                    </button>
                                </div>
                            </div>

                            <!-- Subject Type -->
                            <div class="form-control">
                                <label class="label" for="subject_type">
                                    <span class="label-text font-semibold">Subject Type</span>
                                </label>
                                <select name="subject_type" id="subject_type" class="select select-bordered" required>
                                    <option value="Lecture">Lecture</option>
                                    <option value="Laboratory">Laboratory</option>
                                </select>
                            </div>
                        </div>

                        <!-- Subject Details Card -->
                        <div id="subjectDetails" class="hidden">
                            <div class="card bg-gradient-to-r from-primary/5 to-secondary/5 border border-primary/20">
                                    <div class="card-body p-4">
                                    <div class="flex items-center gap-2 mb-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14 2 14 8 20 8"/>
                                        </svg>
                                        <h4 class="font-semibold text-primary">Subject Details</h4>
                                    </div>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                        <div class="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/>
                                                </svg>
                                                <span class="font-medium">Department:</span>
                                            <span id="selectedDepartment" class="badge badge-outline">-</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                                                    <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                                                </svg>
                                                <span class="font-medium">Year Level:</span>
                                            <span id="selectedYear" class="badge badge-outline">-</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                                                    <line x1="16" x2="16" y1="2" y2="6"/>
                                                    <line x1="8" x2="8" y1="2" y2="6"/>
                                                    <line x1="3" x2="21" y1="10" y2="10"/>
                                                </svg>
                                                <span class="font-medium">Semester:</span>
                                            <span id="selectedSemester" class="badge badge-outline">-</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                                </svg>
                                                <span class="font-medium">Units:</span>
                                            <span id="selectedUnits" class="badge badge-outline">-</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Existing Assignments for this Subject -->
                                    <div id="existingAssignments" class="mt-4 hidden">
                                        <div class="divider text-xs opacity-60">Existing Assignments</div>
                                        <div id="assignmentsList" class="space-y-2 text-xs">
                                            <!-- Dynamic content will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>


                        <button type="submit" class="btn btn-primary w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <line x1="19" x2="19" y1="8" y2="14"/>
                                <line x1="22" x2="16" y1="11" y2="11"/>
                            </svg>
                                    Assign Subject to Instructor
                                </button>
                        </form>
                </div>
                </div>

            <!-- Current Assignments -->
            <div class="card bg-base-100 shadow-refined-medium">
                    <div class="card-body">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                        <div class="flex items-center gap-3">
                        <div class="p-2 bg-primary/10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                            <div>
                            <h2 class="card-title">Current Assignments</h2>
                            <p class="text-sm opacity-60">View and manage subject assignments</p>
                        </div>
                    </div>
                    
                        <!-- Search and Filter Controls -->
                        <div class="flex flex-col gap-3">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <div class="join">
                                    <input type="text" placeholder="Search subjects..." class="join-item input input-bordered w-full sm:w-64" onkeyup="searchAssignments(this.value)" />
                            <button class="join-item btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.3-4.3"/>
                                </svg>
                            </button>
                                </div>
                                <select class="select select-bordered w-full sm:w-40" onchange="filterAssignments(this.value)">
                                    <option value="">Filter</option>
                                    <option value="all">All Assignments</option>
                                    <option value="lecture">Lecture Only</option>
                                    <option value="laboratory">Laboratory Only</option>
                                    <option value="with_schedule">With Schedule</option>
                                    <option value="without_schedule">Without Schedule</option>
                                </select>
                            </div>
                            <!-- Batch Actions -->
                            <div id="batchActions" class="hidden flex items-center gap-3">
                                <button id="selectAllBtn" onclick="selectAllAssignments()" class="btn btn-sm btn-outline">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="9 11 12 14 22 4"/>
                                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                    </svg>
                                    Select All
                                </button>
                                <button id="deselectAllBtn" onclick="deselectAllAssignments()" class="btn btn-sm btn-outline">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="9 11 12 14 22 4"/>
                                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                        <line x1="9" x2="15" y1="9" y2="15"/>
                                        <line x1="15" x2="9" y1="9" y2="15"/>
                                    </svg>
                                    Deselect All
                                </button>
                                <button id="removeSelectedBtn" onclick="removeSelectedAssignments()" class="btn btn-sm btn-error text-white">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                    </svg>
                                    Remove Selected (<span id="selectedCount">0</span>)
                                </button>
                            </div>
                        </div>
                    </div>
                    
                        {% if class_assignments %}
                            <div class="overflow-x-auto rounded-lg border border-base-300">
                            <table class="table table-zebra w-full">
                                    <thead class="bg-base-200">
                                        <tr>
                                            <th class="text-center font-semibold w-[3%] min-w-[50px]">
                                                <input type="checkbox" id="selectAllCheckbox" class="checkbox checkbox-sm" onchange="toggleSelectAll(this)">
                                            </th>
                                            <th class="text-left font-semibold w-[22%] min-w-[200px]">Subject</th>
                                            <th class="text-left font-semibold w-[18%] min-w-[150px]">Instructor</th>
                                            <th class="text-left font-semibold w-[16%] min-w-[140px]">Schedule</th>
                                            <th class="text-left font-semibold w-[13%] min-w-[120px]">Location & Type</th>
                                            <th class="text-left font-semibold w-[13%] min-w-[130px]">Section & Academic Year</th>
                                            <th class="text-center font-semibold w-[7%] min-w-[100px]">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="assignmentsTableBody" style="display: none;">
                                        {% for assignment in class_assignments %}
                                        <tr class="hover transition-colors duration-200">
                                            <!-- Checkbox Column -->
                                            <td class="text-center align-top">
                                                <input type="checkbox" class="assignment-checkbox checkbox checkbox-sm" value="{{ assignment.id }}" onchange="updateSelectedCount()">
                                            </td>
                                            <!-- Subject Column -->
                                            <td class="w-[22%] min-w-[200px] align-top">
                                                <div class="flex items-start gap-3">
                                                    <div class="p-2 bg-primary/10 rounded-lg flex-shrink-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                                        </svg>
                                                    </div>
                                                    <div class="flex-1 min-w-0">
                                                        <div class="font-semibold text-base-content truncate">{{ assignment.subject.subject_code }}</div>
                                                        <div class="text-sm opacity-70 truncate">{{ assignment.subject.subject_name }}</div>
                                                        <div class="flex gap-2 mt-1 flex-wrap">
                                                            <div class="badge badge-outline badge-sm">{{ assignment.subject.department }}</div>
                                                            <div class="badge badge-outline badge-sm">{{ assignment.subject.units }} units</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            
                                            <!-- Instructor Column -->
                                            <td class="w-[20%] min-w-[150px] align-top">
                                                <div class="flex items-start gap-3">
                                                    <div class="avatar placeholder flex-shrink-0">
                                                        <div class="w-10 h-10 rounded-full bg-secondary text-secondary-content">
                                                            <span class="text-sm font-semibold">{{ assignment.instructor.first_name[0] }}{{ assignment.instructor.last_name[0] }}</span>
                                                        </div>
                                                    </div>
                                                    <div class="flex-1 min-w-0">
                                                        <div class="font-medium text-sm truncate">{{ assignment.instructor.first_name }} {{ assignment.instructor.last_name }}</div>
                                                        <div class="text-xs opacity-60 truncate">{{ assignment.instructor.department }}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            
                                            <!-- Schedule Column -->
                                            <td class="w-[18%] min-w-[140px] align-top">
                                                <div class="space-y-2">
                                                    {% if assignment.schedule_time %}
                                                        <div class="flex items-start gap-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-secondary flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <circle cx="12" cy="12" r="10"/>
                                                                <polyline points="12 6 12 12 16 14"/>
                                                            </svg>
                                                            <span class="text-sm font-medium truncate">{{ assignment.schedule_time }}</span>
                                                        </div>
                                                    {% endif %}
                                                    {% if assignment.schedule_day %}
                                                        <div class="flex items-start gap-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-secondary flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                                                                <line x1="16" x2="16" y1="2" y2="6"/>
                                                                <line x1="8" x2="8" y1="2" y2="6"/>
                                                                <line x1="3" x2="21" y1="10" y2="10"/>
                                                            </svg>
                                                            <span class="text-sm truncate">{{ assignment.schedule_day }}</span>
                                                        </div>
                                                    {% endif %}
                                                    {% if not assignment.schedule_time and not assignment.schedule_day %}
                                                        <div class="flex items-start gap-2 text-xs opacity-60">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <circle cx="12" cy="12" r="10"/>
                                                                <line x1="15" x2="9" y1="9" y2="15"/>
                                                                <line x1="9" x2="15" y1="9" y2="15"/>
                                                            </svg>
                                                            <span>No schedule set</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            
                                            <!-- Location & Type Column -->
                                            <td class="w-[15%] min-w-[120px] align-top">
                                                <div class="space-y-2">
                                                    {% if assignment.room %}
                                                        <div class="flex items-start gap-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-accent flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                                            </svg>
                                                            <span class="text-sm font-medium truncate">{{ assignment.room }}</span>
                                                        </div>
                                                    {% endif %}
                                                    {% if assignment.subject_type %}
                                                        <div class="badge {{ 'badge-primary' if assignment.subject_type == 'Lecture' else 'badge-secondary' }} badge-sm">
                                                            {{ assignment.subject_type }}
                                                        </div>
                                                    {% endif %}
                                                    {% if not assignment.room and not assignment.subject_type %}
                                                        <div class="text-xs opacity-60">No details set</div>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            
                                            <!-- Assignment Info Column -->
                                            <td class="w-[15%] min-w-[130px] align-top">
                                                <div class="space-y-2">
                                                    <div class="flex gap-2 flex-wrap">
                                                        <div class="badge badge-info badge-sm">
                                                            {% if assignment.section %}
                                                                Section {{ assignment.section }}
                                                            {% else %}
                                                                General
                                                            {% endif %}
                                                        </div>
                                                        <div class="badge badge-secondary badge-sm">
                                                            {{ assignment.semester }}{% if assignment.semester == 1 %}st{% else %}nd{% endif %} Sem
                                                        </div>
                                                    </div>
                                                    <div class="text-xs font-medium text-primary truncate">
                                                        {{ assignment.school_year }}
                                                    </div>
                                                    <div class="text-xs opacity-60 truncate">
                                                        {{ assignment.subject.year_level }}{% if assignment.subject.year_level == 1 %}st{% elif assignment.subject.year_level == 2 %}nd{% elif assignment.subject.year_level == 3 %}rd{% else %}th{% endif %} Year
                                                    </div>
                                                </div>
                                            </td>
                                            
                                            <!-- Actions Column -->
                                            <td class="w-[7%] min-w-[100px] text-center align-top">
                                                <div class="flex flex-col gap-2 items-center">
                                                    <button onclick="openAssignModal('{{ assignment.subject.id }}', '{{ assignment.id }}')" 
                                                            class="flex items-center justify-center gap-1 px-2 py-1.5 border-2 border-primary text-primary hover:bg-primary hover:text-primary-content rounded-lg transition-all duration-200 hover:shadow-md text-xs"
                                                            title="Reassign subject">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                                        </svg>
                                                        <span class="font-medium">Edit</span>
                                                    </button>
                                                    <button onclick="unassignSubject('{{ assignment.id }}')" 
                                                            class="flex items-center justify-center gap-1 px-2 py-1.5 border-2 border-error text-error hover:bg-error hover:text-error-content rounded-lg transition-all duration-200 hover:shadow-md text-xs"
                                                            title="Remove assignment">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                                <path d="M3 6h18"/>
                                                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                                        </svg>
                                                        <span class="font-medium">Remove</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                        <div class="text-center py-12">
                            <div class="p-4 bg-base-200 rounded-full w-fit mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/>
                                    <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold mb-2">No Subjects Found</h3>
                            <p class="opacity-60">Add subjects to start making assignments</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
    </div>
</section>

<!-- Assignment Modal -->
<dialog id="assignModal" class="modal">
    <div class="modal-box max-w-lg">
        <h3 class="font-bold text-lg mb-4">Assign Subject</h3>
        <button onclick="closeModal()" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        
        <div id="modalSubjectInfo" class="card bg-base-200 mb-6">
            <div class="card-body p-4">
                <h4 class="font-semibold mb-3" id="modalSubjectTitle">Subject Details</h4>
                <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/>
                        </svg>
                        <span class="font-medium">Department:</span>
                        <span id="modalDepartment">-</span>
                </div>
                <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                            <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                        </svg>
                        <span class="font-medium">Year Level:</span>
                        <span id="modalYear">-</span>
                </div>
                <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                            <line x1="16" x2="16" y1="2" y2="6"/>
                            <line x1="8" x2="8" y1="2" y2="6"/>
                            <line x1="3" x2="21" y1="10" y2="10"/>
                        </svg>
                        <span class="font-medium">Semester:</span>
                        <span id="modalSemester">-</span>
                </div>
                <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                        <span class="font-medium">Units:</span>
                        <span id="modalUnits">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <form id="assignModalForm" method="POST" action="{{ url_for('assign_subject') }}">
            <input type="hidden" id="modalSubjectId" name="subject_id">
            <input type="hidden" id="modalAssignmentId" name="assignment_id">
            
            <div class="form-control mb-4">
                <label class="label" for="modalInstructorId">
                    <span class="label-text font-semibold">Select Instructor</span>
                </label>
                <select name="instructor_id" id="modalInstructorId" class="select select-bordered" required>
                    <option value="">Choose an instructor</option>
                    {% for instructor in instructors %}
                        <option value="{{ instructor.id }}" data-department="{{ instructor.department }}">
                            {{ instructor.first_name }} {{ instructor.last_name }} ({{ instructor.department }})
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Section -->
            <div class="form-control mb-4">
                <label class="label" for="modalSection">
                    <span class="label-text font-semibold">Section</span>
                </label>
                <select name="section" id="modalSection" class="select select-bordered" required>
                    <option value="">Select a section</option>
                    {% for section in sections %}
                        <option value="{{ section }}">{{ section }}</option>
                    {% endfor %}
                    {% if not sections %}
                        <option value="" disabled>No sections available - Create students first</option>
                    {% endif %}
                </select>
            </div>

            <!-- Academic Year -->
            <div class="form-control mb-4">
                <label class="label" for="modalSchoolYear">
                    <span class="label-text font-semibold">Academic Year</span>
                </label>
                <div class="join w-full">
                    <select name="school_year" id="modalSchoolYear" class="select select-bordered join-item flex-1" required>
                        <option value="">Select academic year</option>
                        <option value="2025-2026" selected>2025-2026</option>
                        <option value="2026-2027">2026-2027</option>
                    </select>
                    <button type="button" onclick="openAddAcademicYearModal('modal')" class="btn btn-outline join-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Year
                    </button>
                </div>
            </div>

            <!-- Schedule Time -->
            <div class="form-control mb-4">
                <label class="label" for="modalScheduleTime">
                    <span class="label-text font-semibold">Schedule Time</span>
                </label>
                <input type="text" name="schedule_time" id="modalScheduleTime" 
                       class="input input-bordered" 
                       placeholder="8:00 AM - 11:00 AM"
                       pattern="[0-9]{1,2}:[0-9]{2} [AP]M - [0-9]{1,2}:[0-9]{2} [AP]M">
                <label class="label">
                    <span class="label-text-alt">Format: 8:00 AM - 11:00 AM</span>
                </label>
            </div>

            <!-- Schedule Day -->
            <div class="form-control mb-4">
                <label class="label" for="modalScheduleDay">
                    <span class="label-text font-semibold">Schedule Day</span>
                </label>
                <select name="schedule_day" id="modalScheduleDay" class="select select-bordered">
                    <option value="">Select a day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                </select>
            </div>

            <!-- Room -->
            <div class="form-control mb-4">
                <label class="label" for="modalRoom">
                    <span class="label-text font-semibold">Room</span>
                </label>
                <div class="join w-full">
                    <select name="room" id="modalRoom" class="select select-bordered join-item flex-1">
                        <option value="">Select a room</option>
                        <option value="Room 101">Room 101</option>
                        <option value="Room 102">Room 102</option>
                        <option value="Room 201">Room 201</option>
                        <option value="Room 202">Room 202</option>
                        <option value="Computer Lab 1">Computer Lab 1</option>
                        <option value="Computer Lab 2">Computer Lab 2</option>
                        <option value="Library">Library</option>
                        <option value="Auditorium">Auditorium</option>
                    </select>
                    <button type="button" onclick="openAddRoomModal('modal')" class="btn btn-outline join-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Room
                    </button>
                </div>
            </div>

            <!-- Subject Type -->
            <div class="form-control mb-4">
                <label class="label" for="modalSubjectType">
                    <span class="label-text font-semibold">Subject Type</span>
                </label>
                <select name="subject_type" id="modalSubjectType" class="select select-bordered" required>
                    <option value="Lecture">Lecture</option>
                    <option value="Laboratory">Laboratory</option>
                </select>
            </div>


            <div class="modal-action">
                <button type="button" onclick="closeModal()" class="btn btn-ghost">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <line x1="19" x2="19" y1="8" y2="14"/>
                        <line x1="22" x2="16" y1="11" y2="11"/>
                    </svg>
                    Assign
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button onclick="closeModal()">close</button>
    </form>
</dialog>

<!-- Add Room Modal -->
<dialog id="addRoomModal" class="modal">
    <div class="modal-box max-w-md">
        <h3 class="font-bold text-lg mb-4">Add New Room</h3>
        <button onclick="closeAddRoomModal()" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        
        <div class="form-control mb-4">
            <label class="label" for="newRoomName">
                <span class="label-text font-semibold">Room Name</span>
            </label>
            <input type="text" id="newRoomName" class="input input-bordered" 
                   placeholder="Enter room name (e.g., Room 301, Lab 3)" 
                   maxlength="50">
            <label class="label">
                <span class="label-text-alt">Maximum 50 characters</span>
            </label>
        </div>
        
        <div class="modal-action">
            <button type="button" onclick="closeAddRoomModal()" class="btn btn-ghost">Cancel</button>
            <button type="button" onclick="addNewRoom()" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Room
            </button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button onclick="closeAddRoomModal()">close</button>
    </form>
</dialog>

<!-- Add Academic Year Modal -->
<dialog id="addAcademicYearModal" class="modal">
    <div class="modal-box max-w-md">
        <h3 class="font-bold text-lg mb-4">Add New Academic Year</h3>
        <button onclick="closeAddAcademicYearModal()" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        
        <div class="form-control mb-4">
            <label class="label" for="newAcademicYear">
                <span class="label-text font-semibold">Academic Year</span>
            </label>
            <input type="text" id="newAcademicYear" class="input input-bordered" 
                   placeholder="Enter academic year (e.g., 2027-2028)" 
                   maxlength="20"
                   pattern="[0-9]{4}-[0-9]{4}">
            <label class="label">
                <span class="label-text-alt">Format: YYYY-YYYY (e.g., 2027-2028)</span>
            </label>
        </div>
        
        <div class="modal-action">
            <button type="button" onclick="closeAddAcademicYearModal()" class="btn btn-ghost">Cancel</button>
            <button type="button" onclick="addNewAcademicYear()" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Academic Year
            </button>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button onclick="closeAddAcademicYearModal()">close</button>
    </form>
</dialog>

<script>
    // Modal functionality
    const modal = document.getElementById('assignModal');
    const subjects = [
        {% for subject in subjects %}
        {
            id: {{ subject.id }},
            code: "{{ subject.subject_code }}",
            name: "{{ subject.subject_name }}",
            department: "{{ subject.department }}",
            year_level: {{ subject.year_level }},
            semester: {{ subject.semester }},
            units: {{ subject.units }}
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];
    
    const classAssignments = [
        {% for assignment in class_assignments %}
        {
            id: {{ assignment.id }},
            subject_id: {{ assignment.subject_id }},
            instructor: {
                id: {{ assignment.instructor.id }},
                first_name: "{{ assignment.instructor.first_name }}",
                last_name: "{{ assignment.instructor.last_name }}"
            },
            section: "{{ assignment.section or '' }}",
            school_year: "{{ assignment.school_year }}",
            semester: {{ assignment.semester }},
            subject_type: "{{ assignment.subject_type or 'Lecture' }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];
    
    function openAssignModal(subjectId, assignmentId = null) {
        const subject = subjects.find(s => s.id == subjectId);
        if (subject) {
            document.getElementById('modalSubjectId').value = subjectId;
            document.getElementById('modalAssignmentId').value = assignmentId || '';
            document.getElementById('modalSubjectTitle').textContent = `${subject.code} - ${subject.name}`;
            document.getElementById('modalDepartment').textContent = subject.department;
            document.getElementById('modalYear').textContent = `${subject.year_level}${getOrdinalSuffix(subject.year_level)} Year`;
            document.getElementById('modalSemester').textContent = `${subject.semester}${getOrdinalSuffix(subject.semester)} Semester`;
            document.getElementById('modalUnits').textContent = subject.units;
            
            // If editing an existing assignment, populate form with current data
            if (assignmentId) {
                // Find the assignment data from the table
                const assignmentRow = document.querySelector(`button[onclick*="openAssignModal('${subjectId}', '${assignmentId}')"]`).closest('tr');
                if (assignmentRow) {
                    const cells = assignmentRow.querySelectorAll('td');
                    
                    // Extract instructor name from the instructor column
                    const instructorCell = cells[1];
                    const instructorName = instructorCell.querySelector('.font-medium').textContent.trim();
                    
                    // Find instructor ID by matching name
                    const instructorSelect = document.getElementById('modalInstructorId');
                    for (let option of instructorSelect.options) {
                        if (option.textContent.includes(instructorName)) {
                            document.getElementById('modalInstructorId').value = option.value;
                            break;
                        }
                    }
                    
                    // Extract section from assignment info column
                    const sectionBadge = cells[4].querySelector('.badge-info');
                    if (sectionBadge) {
                        const sectionText = sectionBadge.textContent.trim();
                        const sectionMatch = sectionText.match(/Section (.+)/);
                        if (sectionMatch) {
                            document.getElementById('modalSection').value = sectionMatch[1];
                        }
                    }
                    
                    // Extract academic year
                    const yearText = cells[4].querySelector('.text-primary').textContent.trim();
                    document.getElementById('modalSchoolYear').value = yearText;
                    
                    // Extract schedule time and day from schedule column
                    const scheduleCell = cells[2];
                    const timeElement = scheduleCell.querySelector('.text-sm.font-medium');
                    if (timeElement) {
                        document.getElementById('modalScheduleTime').value = timeElement.textContent.trim();
                    }
                    
                    const dayElement = scheduleCell.querySelector('.text-sm:not(.font-medium)');
                    if (dayElement) {
                        document.getElementById('modalScheduleDay').value = dayElement.textContent.trim();
                    }
                    
                    // Extract room from location column
                    const roomElement = cells[3].querySelector('.text-sm.font-medium');
                    if (roomElement) {
                        document.getElementById('modalRoom').value = roomElement.textContent.trim();
                    }
                    
                    // Extract subject type
                    const typeBadge = cells[3].querySelector('.badge-primary, .badge-secondary');
                    if (typeBadge) {
                        document.getElementById('modalSubjectType').value = typeBadge.textContent.trim();
                    }
                }
            } else {
                // Reset form fields for new assignment
                document.getElementById('modalInstructorId').value = '';
                document.getElementById('modalSection').value = '';
                document.getElementById('modalSchoolYear').value = '';
                document.getElementById('modalScheduleTime').value = '';
                document.getElementById('modalScheduleDay').value = '';
                document.getElementById('modalRoom').value = '';
                document.getElementById('modalSubjectType').value = 'Lecture';
            }
            
            modal.showModal();
        }
    }
    
    function closeModal() {
        modal.close();
        document.getElementById('modalInstructorId').value = '';
        document.getElementById('modalSection').value = '';
        document.getElementById('modalSchoolYear').value = '';
        document.getElementById('modalScheduleTime').value = '';
        document.getElementById('modalScheduleDay').value = '';
        document.getElementById('modalRoom').value = '';
        document.getElementById('modalSubjectType').value = 'Lecture';
    }
    
    // Room management functionality
    let currentRoomContext = 'main'; // Track which form we're adding room to
    
    function openAddRoomModal(context = 'main') {
        currentRoomContext = context;
        document.getElementById('newRoomName').value = '';
        document.getElementById('addRoomModal').showModal();
    }
    
    function closeAddRoomModal() {
        document.getElementById('addRoomModal').close();
        document.getElementById('newRoomName').value = '';
    }
    
    function addNewRoom() {
        const roomName = document.getElementById('newRoomName').value.trim();
        
        if (!roomName) {
            showToast('Please enter a room name', 'error');
            return;
        }
        
        if (roomName.length > 50) {
            showToast('Room name must be 50 characters or less', 'error');
            return;
        }
        
        // Add room to both dropdowns
        addRoomToDropdown('room', roomName);
        addRoomToDropdown('modalRoom', roomName);
        
        // Save to localStorage for persistence
        saveRoomToStorage(roomName);
        
        // Set the newly added room as selected
        const targetSelect = currentRoomContext === 'modal' ? 'modalRoom' : 'room';
        document.getElementById(targetSelect).value = roomName;
        
        closeAddRoomModal();
        showToast(`Room "${roomName}" added successfully`, 'success');
    }
    
    function addRoomToDropdown(selectId, roomName) {
        const select = document.getElementById(selectId);
        
        // Check if room already exists
        const existingOption = Array.from(select.options).find(option => option.value === roomName);
        if (!existingOption) {
            const newOption = document.createElement('option');
            newOption.value = roomName;
            newOption.textContent = roomName;
            select.appendChild(newOption);
        }
    }
    
    function saveRoomToStorage(roomName) {
        let savedRooms = JSON.parse(localStorage.getItem('savedRooms') || '[]');
        if (!savedRooms.includes(roomName)) {
            savedRooms.push(roomName);
            localStorage.setItem('savedRooms', JSON.stringify(savedRooms));
        }
    }
    
    function loadSavedRooms() {
        const savedRooms = JSON.parse(localStorage.getItem('savedRooms') || '[]');
        savedRooms.forEach(roomName => {
            addRoomToDropdown('room', roomName);
            addRoomToDropdown('modalRoom', roomName);
        });
    }
    
    // Academic Year management functionality
    let currentAcademicYearContext = 'main'; // Track which form we're adding academic year to
    
    function openAddAcademicYearModal(context = 'main') {
        currentAcademicYearContext = context;
        document.getElementById('newAcademicYear').value = '';
        document.getElementById('addAcademicYearModal').showModal();
    }
    
    function closeAddAcademicYearModal() {
        document.getElementById('addAcademicYearModal').close();
        document.getElementById('newAcademicYear').value = '';
    }
    
    function addNewAcademicYear() {
        const academicYear = document.getElementById('newAcademicYear').value.trim();
        
        if (!academicYear) {
            showToast('Please enter an academic year', 'error');
            return;
        }
        
        // Validate format (YYYY-YYYY)
        const yearPattern = /^[0-9]{4}-[0-9]{4}$/;
        if (!yearPattern.test(academicYear)) {
            showToast('Please enter academic year in format YYYY-YYYY (e.g., 2027-2028)', 'error');
            return;
        }
        
        // Validate year range (second year should be next year)
        const [startYear, endYear] = academicYear.split('-').map(Number);
        if (endYear !== startYear + 1) {
            showToast('Academic year should be consecutive years (e.g., 2027-2028)', 'error');
            return;
        }
        
        // Add academic year to both dropdowns
        addAcademicYearToDropdown('school_year', academicYear);
        addAcademicYearToDropdown('modalSchoolYear', academicYear);
        
        // Save to localStorage for persistence
        saveAcademicYearToStorage(academicYear);
        
        // Set the newly added academic year as selected
        const targetSelect = currentAcademicYearContext === 'modal' ? 'modalSchoolYear' : 'school_year';
        document.getElementById(targetSelect).value = academicYear;
        
        closeAddAcademicYearModal();
        showToast(`Academic year "${academicYear}" added successfully`, 'success');
    }
    
    function addAcademicYearToDropdown(selectId, academicYear) {
        const select = document.getElementById(selectId);
        
        // Check if academic year already exists
        const existingOption = Array.from(select.options).find(option => option.value === academicYear);
        if (!existingOption) {
            const newOption = document.createElement('option');
            newOption.value = academicYear;
            newOption.textContent = academicYear;
            select.appendChild(newOption);
        }
    }
    
    function saveAcademicYearToStorage(academicYear) {
        let savedAcademicYears = JSON.parse(localStorage.getItem('savedAcademicYears') || '[]');
        if (!savedAcademicYears.includes(academicYear)) {
            savedAcademicYears.push(academicYear);
            // Sort academic years for better organization
            savedAcademicYears.sort();
            localStorage.setItem('savedAcademicYears', JSON.stringify(savedAcademicYears));
        }
    }
    
    function loadSavedAcademicYears() {
        const savedAcademicYears = JSON.parse(localStorage.getItem('savedAcademicYears') || '[]');
        savedAcademicYears.forEach(academicYear => {
            addAcademicYearToDropdown('school_year', academicYear);
            addAcademicYearToDropdown('modalSchoolYear', academicYear);
        });
    }
    
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 z-50';
        
        const bgColor = type === 'success' ? 'bg-green-50 border-green-500' : 
                       type === 'error' ? 'bg-red-50 border-red-500' : 
                       'bg-blue-50 border-blue-500';
        const textColor = type === 'success' ? 'text-green-800' : 
                         type === 'error' ? 'text-red-800' : 
                         'text-blue-800';
        const iconColor = type === 'success' ? 'text-green-600' : 
                         type === 'error' ? 'text-red-600' : 
                         'text-blue-600';
        
        const icon = type === 'success' ? 
            '<polyline points="20 6 9 17 4 12"/>' :
            type === 'error' ?
            '<circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/>' :
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>';
        
        toast.innerHTML = `
            <div class="${bgColor} border-l-4 p-4 rounded-lg shadow-refined-light">
                <div class="flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${iconColor}">
                        ${icon}
                    </svg>
                    <span class="text-sm font-medium ${textColor}">${message}</span>
                </div>
            </div>
        `;
        
        document.body.appendChild(toast);
        setTimeout(() => {
            if (document.body.contains(toast)) {
                document.body.removeChild(toast);
            }
        }, 3000);
    }
    
    function showSubjectDetails() {
        const subjectSelect = document.getElementById('subject_id');
        const detailsDiv = document.getElementById('subjectDetails');
        const existingAssignmentsDiv = document.getElementById('existingAssignments');
        const assignmentsListDiv = document.getElementById('assignmentsList');
        
        if (subjectSelect.value) {
            const subject = subjects.find(s => s.id == subjectSelect.value);
            if (subject) {
                document.getElementById('selectedDepartment').textContent = subject.department;
                document.getElementById('selectedYear').textContent = `${subject.year_level}${getOrdinalSuffix(subject.year_level)} Year`;
                document.getElementById('selectedSemester').textContent = `${subject.semester}${getOrdinalSuffix(subject.semester)} Semester`;
                document.getElementById('selectedUnits').textContent = subject.units;
                detailsDiv.classList.remove('hidden');
                
                // Show existing assignments for this subject
                showExistingAssignments(subject.id);
            }
        } else {
            detailsDiv.classList.add('hidden');
        }
    }
    
    function showExistingAssignments(subjectId) {
        const existingAssignmentsDiv = document.getElementById('existingAssignments');
        const assignmentsListDiv = document.getElementById('assignmentsList');
        
        // Find all assignments for this subject
        const subjectAssignments = classAssignments.filter(assignment => assignment.subject_id == subjectId);
        
        if (subjectAssignments.length > 0) {
            assignmentsListDiv.innerHTML = '';
            
            subjectAssignments.forEach(assignment => {
                const assignmentItem = document.createElement('div');
                assignmentItem.className = 'flex items-center justify-between p-2 bg-base-200 rounded-lg';
                
                const instructorName = `${assignment.instructor.first_name} ${assignment.instructor.last_name}`;
                const sectionInfo = assignment.section ? `Section ${assignment.section}` : 'General';
                const yearInfo = assignment.school_year;
                
                assignmentItem.innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="avatar placeholder">
                            <div class="w-6 h-6 rounded-full bg-secondary text-secondary-content text-xs">
                                <span>${assignment.instructor.first_name[0]}${assignment.instructor.last_name[0]}</span>
                            </div>
                        </div>
                        <div>
                            <div class="font-medium text-xs">${instructorName}</div>
                            <div class="text-xs opacity-60">${sectionInfo}  ${yearInfo}</div>
                        </div>
                    </div>
                    <div class="badge badge-sm ${assignment.subject_type === 'Lecture' ? 'badge-primary' : 'badge-secondary'}">
                        ${assignment.subject_type}
                    </div>
                `;
                
                assignmentsListDiv.appendChild(assignmentItem);
            });
            
            existingAssignmentsDiv.classList.remove('hidden');
        } else {
            existingAssignmentsDiv.classList.add('hidden');
        }
    }
    
    function getOrdinalSuffix(num) {
        const j = num % 10;
        const k = num % 100;
        if (j == 1 && k != 11) return 'st';
        if (j == 2 && k != 12) return 'nd';
        if (j == 3 && k != 13) return 'rd';
        return 'th';
    }
    
    async function unassignSubject(assignmentId) {
        if (!confirm('Are you sure you want to remove this assignment?')) {
            return;
        }
        
        try {
            const loading = document.createElement('div');
            loading.className = 'fixed top-4 right-4 z-50';
            loading.innerHTML = `
                       <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg shadow-refined-light">
                    <div class="flex items-center gap-3">
                        <svg class="animate-spin w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sm font-medium text-blue-800">Removing assignment...</span>
                    </div>
                </div>
            `;
            document.body.appendChild(loading);
            
            const response = await fetch('/api/unassign-subject', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    assignment_id: assignmentId
                })
            });
            
            const data = await response.json();
            document.body.removeChild(loading);
            
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 z-50';
            
            if (response.ok) {
                toast.innerHTML = `
                       <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg shadow-refined-light">
                        <div class="flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span class="text-sm font-medium text-green-800">Assignment removed successfully</span>
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                    location.reload();
                }, 2000);
            } else {
                toast.innerHTML = `
                       <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg shadow-refined-light">
                        <div class="flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" x2="9" y1="9" y2="15"/>
                                <line x1="9" x2="15" y1="9" y2="15"/>
                            </svg>
                            <span class="text-sm font-medium text-red-800">${data.message || 'Error removing assignment'}</span>
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            }
        } catch (error) {
            console.error('Error:', error);
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 z-50';
            toast.innerHTML = `
                       <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg shadow-refined-light">
                    <div class="flex items-center gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" x2="9" y1="9" y2="15"/>
                            <line x1="9" x2="15" y1="9" y2="15"/>
                        </svg>
                        <span class="text-sm font-medium text-red-800">An error occurred while removing the assignment</span>
                    </div>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }
    }
    
    // Refresh button functionality with loading state
    document.getElementById('refreshBtn').addEventListener('click', function() {
        const btn = this;
        const icon = btn.querySelector('svg');
        icon.classList.add('animate-spin');
        btn.disabled = true;
        
        setTimeout(() => {
            location.reload();
        }, 500);
    });
    
    // Search and filter functionality
    function searchAssignments(query) {
        const tbody = document.getElementById('assignmentsTableBody');
        const rows = document.querySelectorAll('tbody tr');
        const searchText = query.toLowerCase();
        
        if (query.trim() === '') {
            // If search is empty, hide the table
            tbody.style.display = 'none';
            return;
        }
        
        // Show the table when searching
        tbody.style.display = '';
        
        rows.forEach(row => {
            // Skip the checkbox cell and search in the rest
            const text = Array.from(row.querySelectorAll('td')).slice(1).map(td => td.textContent.toLowerCase()).join(' ');
            row.style.display = text.includes(searchText) ? '' : 'none';
        });
    }
    
    function filterAssignments(filterType) {
        const tbody = document.getElementById('assignmentsTableBody');
        const rows = document.querySelectorAll('tbody tr');
        
        if (!filterType || filterType === '') {
            // If no filter selected, hide the table
            tbody.style.display = 'none';
            return;
        }
        
        // Show the table when a filter is selected
        tbody.style.display = '';
        
        rows.forEach(row => {
            if (filterType === 'all') {
                row.style.display = '';
                return;
            }
            
            // Skip the checkbox cell and get text from the rest
            const text = Array.from(row.querySelectorAll('td')).slice(1).map(td => td.textContent.toLowerCase()).join(' ');
            
            switch(filterType) {
                case 'lecture':
                    row.style.display = text.includes('lecture') ? '' : 'none';
                    break;
                case 'laboratory':
                    row.style.display = text.includes('laboratory') ? '' : 'none';
                    break;
                case 'with_schedule':
                    // Check if row has schedule time or day
                    const hasSchedule = row.querySelector('.text-sm.font-medium') || 
                                       (row.querySelector('.text-sm:not(.font-medium)') && 
                                        !row.querySelector('.text-sm:not(.font-medium)').textContent.includes('No schedule'));
                    row.style.display = hasSchedule ? '' : 'none';
                    break;
                case 'without_schedule':
                    // Check if row has no schedule
                    const noSchedule = row.querySelector('.text-xs.opacity-60') && 
                                      row.querySelector('.text-xs.opacity-60').textContent.includes('No schedule');
                    row.style.display = noSchedule ? '' : 'none';
                    break;
                default:
                    row.style.display = '';
            }
        });
    }
    document.addEventListener('DOMContentLoaded', function() {
        loadSavedRooms();
        loadSavedAcademicYears();
        
        // Initialize batch actions as hidden
        document.getElementById('batchActions').classList.add('hidden');
        
        // Check for success messages and show notifications
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('success') === 'true') {
            showAssignmentSuccessNotification();
        }
    });
    
    function showAssignmentSuccessNotification() {
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 z-50 bg-green-50 border-l-4 border-green-500 p-4 rounded-lg shadow-lg';
        
        notification.innerHTML = `
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <span class="text-sm font-medium text-green-800">Subject assignment created successfully!</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Auto-remove notification after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.style.transition = 'opacity 0.3s ease-out';
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }, 5000);
    }
    
    // Allow Enter key to submit in Add Room modal
    document.getElementById('newRoomName').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            addNewRoom();
        }
    });
    
    // Allow Enter key to submit in Add Academic Year modal
    document.getElementById('newAcademicYear').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            addNewAcademicYear();
        }
    });
    
    // Checkbox functionality for batch operations
    function toggleSelectAll(checkbox) {
        const checkboxes = document.querySelectorAll('.assignment-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
        updateSelectedCount();
    }
    
    function selectAllAssignments() {
        const checkboxes = document.querySelectorAll('.assignment-checkbox');
        checkboxes.forEach(cb => cb.checked = true);
        document.getElementById('selectAllCheckbox').checked = true;
        updateSelectedCount();
    }
    
    function deselectAllAssignments() {
        const checkboxes = document.querySelectorAll('.assignment-checkbox');
        checkboxes.forEach(cb => cb.checked = false);
        document.getElementById('selectAllCheckbox').checked = false;
        updateSelectedCount();
    }
    
    function updateSelectedCount() {
        const checkboxes = document.querySelectorAll('.assignment-checkbox:checked');
        const count = checkboxes.length;
        document.getElementById('selectedCount').textContent = count;
        
        // Show/hide batch actions based on selection count
        const batchActions = document.getElementById('batchActions');
        if (count > 0) {
            batchActions.classList.remove('hidden');
        } else {
            batchActions.classList.add('hidden');
        }
    }
    
    async function removeSelectedAssignments() {
        const checkboxes = document.querySelectorAll('.assignment-checkbox:checked');
        const selectedIds = Array.from(checkboxes).map(cb => cb.value);
        
        if (selectedIds.length === 0) {
            showToast('Please select at least one assignment to remove', 'error');
            return;
        }
        
        if (!confirm(`Are you sure you want to remove ${selectedIds.length} assignment(s)?`)) {
            return;
        }
        
        try {
            const loading = document.createElement('div');
            loading.className = 'fixed top-4 right-4 z-50';
            loading.innerHTML = `
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg shadow-refined-light">
                    <div class="flex items-center gap-3">
                        <svg class="animate-spin w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="text-sm font-medium text-blue-800">Removing ${selectedIds.length} assignment(s)...</span>
                    </div>
                </div>
            `;
            document.body.appendChild(loading);
            
            const response = await fetch('/api/unassign-subjects-batch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    assignment_ids: selectedIds
                })
            });
            
            const data = await response.json();
            document.body.removeChild(loading);
            
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 z-50';
            
            if (response.ok) {
                toast.innerHTML = `
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg shadow-refined-light">
                        <div class="flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span class="text-sm font-medium text-green-800">${selectedIds.length} assignment(s) removed successfully</span>
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                    location.reload();
                }, 2000);
            } else {
                toast.innerHTML = `
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg shadow-refined-light">
                        <div class="flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="15" x2="9" y1="9" y2="15"/>
                                <line x1="9" x2="15" y1="9" y2="15"/>
                            </svg>
                            <span class="text-sm font-medium text-red-800">${data.message || 'Error removing assignments'}</span>
                        </div>
                    </div>
                `;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('An error occurred while removing the assignments', 'error');
        }
    }
</script>
{% endblock %}
