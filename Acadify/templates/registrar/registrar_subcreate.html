{% extends "common/base.html" %}

{% block title %}Create Subject - Acadify{% endblock %}

{% block content %}
<section class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header Section -->
        <div class="flex items-center gap-4 mb-8">
            <div class="p-3 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl shadow-refined-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-base-content tracking-tight">Create New Subject</h1>
                <p class="text-base-content/60 mt-1">Add subjects to the curriculum</p>
            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-8 space-y-3">
                    {% for category, message in messages %}
                        <div class="alert {{ 'alert-success' if category == 'success' else ('alert-error' if category == 'error' else 'alert-info') }} shadow-refined-light">
                            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current flex-shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                {% if category == 'success' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% elif category == 'error' %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% else %}
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                {% endif %}
                            </svg>
                            <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endwith %}

        <!-- Subject Creation Form -->
        <div class="card bg-base-100 shadow-refined-medium mb-8">
            <div class="card-body">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-secondary/10 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-secondary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="card-title">Subject Information</h2>
                        <p class="text-sm opacity-60">Fill in the details below</p>
                    </div>
                </div>
                <form method="POST" action="{{ url_for('registrar_subcreate') }}" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-control">
                            <label class="label" for="subject_code">
                                <span class="label-text font-semibold">Subject Code</span>
                            </label>
                            <input type="text" name="subject_code" id="subject_code" required
                                class="input input-bordered"
                                placeholder="e.g., PL101">
                            <label class="label">
                                <span class="label-text-alt">Unique identifier for the subject</span>
                            </label>
                        </div>
                        <div class="form-control">
                            <label class="label" for="subject_name">
                                <span class="label-text font-semibold">Subject Name</span>
                            </label>
                            <input type="text" name="subject_name" id="subject_name" required
                                class="input input-bordered"
                                placeholder="e.g., Introduction to Programming">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-control">
                            <label class="label" for="units">
                                <span class="label-text font-semibold">Units</span>
                            </label>
                            <div class="join">
                                <button type="button" class="btn btn-outline join-item" onclick="adjustUnits(-1)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="5" x2="19" y1="12" y2="12"/>
                                    </svg>
                                </button>
                                <input type="number" name="units" id="units" required min="1" max="6"
                                    class="input input-bordered join-item flex-1 text-center"
                                    value="3">
                                <button type="button" class="btn btn-outline join-item" onclick="adjustUnits(1)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" x2="12" y1="5" y2="19"/>
                                        <line x1="5" x2="19" y1="12" y2="12"/>
                                    </svg>
                                </button>
                            </div>
                            <label class="label">
                                <span class="label-text-alt">Number of credit units (1-6)</span>
                            </label>
                        </div>
                        <div class="form-control">
                            <label class="label" for="department">
                                <span class="label-text font-semibold">Department</span>
                            </label>
                            <select name="department" id="department" required class="select select-bordered">
                                <option value="">Select Department</option>
                                <option value="BSCS">BSCS - Bachelor of Science in Computer Science</option>
                                <option value="BEED">BEED - Bachelor of Elementary Education</option>
                                <option value="BSHM">BSHM - Bachelor of Science in Hospitality Management</option>
                                <option value="BSED">BSED - Bachelor of Secondary Education</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-control">
                            <label class="label" for="year_level">
                                <span class="label-text font-semibold">Year Level</span>
                            </label>
                            <select name="year_level" id="year_level" required class="select select-bordered">
                                <option value="">Select Year Level</option>
                                <option value="1">1st Year</option>
                                <option value="2">2nd Year</option>
                                <option value="3">3rd Year</option>
                                <option value="4">4th Year</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <label class="label" for="semester">
                                <span class="label-text font-semibold">Semester</span>
                            </label>
                            <select name="semester" id="semester" required class="select select-bordered">
                                <option value="">Select Semester</option>
                                <option value="1">1st Semester</option>
                                <option value="2">2nd Semester</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="form-control">
                            <label class="label" for="subject_academic">
                                <span class="label-text font-semibold">Subject Academic</span>
                            </label>
                            <select name="subject_academic" id="subject_academic" required class="select select-bordered">
                                <option value="">Select Type</option>
                                <option value="Academic">Academic</option>
                                <option value="Non Academic">Non Academic</option>
                            </select>
                        </div>
                        <div class="form-control">
                            <!-- Empty div for grid layout balance -->
                        </div>
                    </div>


                    <div class="pt-4">
                        <button type="submit" class="btn btn-primary w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" x2="12" y1="8" y2="16"/>
                                <line x1="8" x2="16" y1="12" y2="12"/>
                            </svg>
                            Create Subject
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Existing Subjects -->
        <div class="card bg-base-100 shadow-refined-medium">
            <div class="card-body">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-primary/10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="8" x2="21" y1="6" y2="6"/>
                                <line x1="8" x2="21" y1="12" y2="12"/>
                                <line x1="8" x2="21" y1="18" y2="18"/>
                                <line x1="3" x2="3.01" y1="6" y2="6"/>
                                <line x1="3" x2="3.01" y1="12" y2="12"/>
                                <line x1="3" x2="3.01" y1="18" y2="18"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="card-title">Existing Subjects</h2>
                            <p class="text-sm opacity-60">View all subjects in the system</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="join">
                            <input type="text" placeholder="Search subjects..." 
                                class="join-item input input-bordered flex-1" 
                                onkeyup="filterTable(this.value)" />
                            <button class="join-item btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.3-4.3"/>
                                </svg>
                            </button>
                        </div>
                        <select class="select select-bordered" onchange="filterByDepartment(this.value)">
                            <option value="">Select Department</option>
                            <option value="BSCS">BSCS</option>
                            <option value="BEED">BEED</option>
                            <option value="BSHM">BSHM</option>
                            <option value="BSED">BSED</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead>
                            <tr>
                                <th class="text-left">Subject</th>
                                <th class="text-left">Department</th>
                                <th class="text-left">Year/Sem</th>
                                <th class="text-center">Units</th>
                                <th class="text-left">Type</th>
                                <th class="text-left">Status</th>
                            </tr>
                        </thead>
                        <tbody id="subjectsTableBody" style="display: none;">
                            {% for subject in subjects %}
                            <tr class="hover">
                                <td>
                                    <div class="font-semibold">{{ subject.subject_code }}</div>
                                    <div class="text-xs opacity-60">{{ subject.subject_name }}</div>
                                </td>
                                <td>
                                    <div class="badge badge-outline">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                        </svg>
                                        {{ subject.department }}
                                    </div>
                                </td>
                                <td>
                                    <div class="text-sm">
                                        {{ subject.year_level }}{% if subject.year_level == 1 %}st{% elif subject.year_level == 2 %}nd{% elif subject.year_level == 3 %}rd{% else %}th{% endif %} Yr, 
                                        {{ subject.semester }}{% if subject.semester == 1 %}st{% else %}nd{% endif %} Sem
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="badge badge-primary">{{ subject.units }} units</div>
                                </td>
                                <td>
                                    <div class="badge {{ 'badge-info' if subject.subject_type == 'Academic' else 'badge-secondary' }}">
                                        {{ subject.subject_type }}
                                    </div>
                                </td>
                                <td>
                                    {% if subject.id in assigned_subject_ids %}
                                        <div class="badge badge-success">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                            Assigned
                                        </div>
                                    {% else %}
                                        <div class="badge badge-warning">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="12" cy="12" r="10"/>
                                                <line x1="12" x2="12" y1="8" y2="12"/>
                                                <line x1="12" x2="12.01" y1="16" y2="16"/>
                                            </svg>
                                            Unassigned
                                        </div>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</section>

<script>
    // Units adjustment function
    function adjustUnits(change) {
        const unitsInput = document.getElementById('units');
        const currentValue = parseInt(unitsInput.value) || 3;
        const newValue = Math.min(Math.max(currentValue + change, 1), 6);
        unitsInput.value = newValue;
    }

    // Table filter functions
    function filterTable(query) {
        const tbody = document.getElementById('subjectsTableBody');
        const rows = document.querySelectorAll('tbody tr');
        const searchText = query.toLowerCase();
        
        if (query.trim() === '') {
            // If search is empty, hide the table
            tbody.style.display = 'none';
            return;
        }
        
        // Show the table when searching
        tbody.style.display = '';
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchText) ? '' : 'none';
        });
    }

    function filterByDepartment(department) {
        const tbody = document.getElementById('subjectsTableBody');
        const rows = document.querySelectorAll('tbody tr');
        
        if (!department) {
            // If no department selected, hide the table
            tbody.style.display = 'none';
            return;
        }
        
        // Show the table when a department is selected
        tbody.style.display = '';
        
        rows.forEach(row => {
            // Department is still the 2nd column (td:nth-child(2))
            const deptCell = row.querySelector('td:nth-child(2)');
            const deptText = deptCell.textContent.trim();
            row.style.display = deptText.includes(department) ? '' : 'none';
        });
    }
</script>
{% endblock %}
