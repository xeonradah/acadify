{% extends "common/base.html" %}

{% block title %}Subject Offering - Acadify{% endblock %}

{% block content %}
<section class="min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-base-content tracking-tight">Subject Offering</h1>
                    <p class="text-base-content/60 mt-1">Manage subject offerings and enrollment</p>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                </div>
                <div class="stat-title">Total Subjects</div>
                <div class="stat-value text-primary">{{ subjects|length }}</div>
                <div class="stat-desc">Available courses</div>
            </div>
            
            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-title">Assigned Subjects</div>
                <div class="stat-value text-secondary">{{ subjects|selectattr('class_assignments')|list|length }}</div>
                <div class="stat-desc">With instructors</div>
            </div>
            
            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-accent">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-title">Total Enrollments</div>
                <div class="stat-value text-accent">{{ subjects|sum(attribute='enrolled_count') }}</div>
                <div class="stat-desc">Active students</div>
            </div>
            
            <div class="stat bg-base-100 shadow-xl rounded-lg">
                <div class="stat-figure text-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                </div>
                <div class="stat-title">Unassigned</div>
                <div class="stat-value text-warning">{{ subjects|rejectattr('class_assignments')|list|length }}</div>
                <div class="stat-desc">Need instructors</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="card bg-base-100 shadow-xl mb-6">
            <div class="card-body">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-primary/10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="card-title">Subject Management</h2>
                            <p class="text-sm opacity-60">Manage subject offerings and enrollment</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3 mb-6">
                    <button class="btn btn-primary gap-2" onclick="enlistProctoring()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Enlist Proctoring
                    </button>
                    <button class="btn btn-secondary gap-2" onclick="enlistGESubject()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                        Enlist GE Subject
                    </button>
                    <button class="btn btn-accent gap-2" onclick="enlistMerged()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                        </svg>
                        Enlist Merged
                    </button>
                    <button class="btn btn-info gap-2" onclick="enlistSubject()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Enlist Subject
                    </button>
                    <button class="btn btn-warning gap-2" onclick="refreshContent()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                            <path d="M3 21v-5h5"/>
                        </svg>
                        Refresh Content
                    </button>
                </div>

                <!-- Search and Filters -->
                <div class="flex flex-col lg:flex-row gap-4 mb-6">
                    <!-- Search -->
                    <div class="flex-1">
                        <div class="join w-full">
                            <input class="join-item input input-bordered flex-1" 
                                   placeholder="Search subject..." 
                                   id="searchSubject"
                                   onkeyup="filterSubjects()">
                            <button class="join-item btn btn-primary" onclick="searchSubjects()">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.3-4.3"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Year Dropdown -->
                    <div class="form-control">
                        <select class="select select-bordered" id="yearFilter" onchange="filterSubjects()">
                            <option value="">All Years</option>
                            <option value="1st Year">1st Year</option>
                            <option value="2nd Year">2nd Year</option>
                            <option value="3rd Year">3rd Year</option>
                            <option value="4th Year">4th Year</option>
                        </select>
                    </div>

                    <!-- Semester Dropdown -->
                    <div class="form-control">
                        <select class="select select-bordered" id="semesterFilter" onchange="filterSubjects()">
                            <option value="">All Semesters</option>
                            <option value="1st Semester">1st Semester</option>
                            <option value="2nd Semester">2nd Semester</option>
                            <option value="Summer">Summer</option>
                        </select>
                    </div>

                    <!-- Delete Button -->
                    <button class="btn btn-error gap-2" onclick="deleteSelected()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"/>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        </svg>
                        Delete
                    </button>
                </div>
            </div>
        </div>

        <!-- Subject Table -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-success/10 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 3h18v18H3zM21 9H3"/>
                                <path d="M9 9v12"/>
                            </svg>
                        </div>
                        <div>
                            <h2 class="card-title">Subject Offerings</h2>
                            <p class="text-sm opacity-60">Current semester subject offerings</p>
                        </div>
                    </div>
                    <div class="text-sm opacity-60">
                        Total: <span id="totalSubjects">{{ subjects|length }}</span> subjects
                    </div>
                </div>

                <div class="overflow-x-auto shadow-sm rounded-lg border border-base-300">
                    <table class="table table-zebra w-full min-w-max">
                        <thead>
                            <tr class="bg-base-200">
                                <th class="w-12 text-center">
                                    <input type="checkbox" class="checkbox checkbox-sm" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th class="w-20 text-center">Section</th>
                                <th class="w-48 text-left">Subject</th>
                                <th class="w-16 text-center">Units</th>
                                <th class="w-20 text-center">Dept</th>
                                <th class="w-24 text-center">Time</th>
                                <th class="w-20 text-center">Day</th>
                                <th class="w-20 text-center">Room</th>
                                <th class="w-24 text-center">Type</th>
                                <th class="w-40 text-left">Professor</th>
                                <th class="w-24 text-center">Enrolled</th>
                                <th class="w-32 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subjectsTableBody">
                            {% if subjects %}
                                {% for subject in subjects %}
                                <tr class="hover">
                                    <td class="text-center">
                                        <input type="checkbox" class="checkbox checkbox-sm subject-checkbox" value="{{ subject.id }}">
                                    </td>
                                    <td class="text-center">
                                        <div class="badge badge-outline badge-sm">
                                            {% if subject.class_assignments %}
                                                {% for assignment in subject.class_assignments %}
                                                    {{ assignment.section }}{% if not loop.last %}, {% endif %}
                                                {% endfor %}
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="flex flex-col">
                                            <div class="font-semibold text-sm">{{ subject.subject_code or 'N/A' }}</div>
                                            <div class="text-xs opacity-70 truncate max-w-40">{{ subject.subject_name or 'N/A' }}</div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="badge badge-outline badge-sm">
                                            {{ subject.units or 'N/A' }}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="badge badge-info badge-sm">
                                            {{ subject.department or 'N/A' }}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="text-xs">
                                            {% if subject.class_assignments %}
                                                {% for assignment in subject.class_assignments %}
                                                    <div class="badge badge-ghost badge-xs">{{ assignment.schedule_time or 'TBA' }}</div>{% if not loop.last %}<br>{% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <div class="badge badge-ghost badge-xs">TBA</div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="text-xs">
                                            {% if subject.class_assignments %}
                                                {% for assignment in subject.class_assignments %}
                                                    <div class="badge badge-ghost badge-xs">{{ assignment.schedule_day or 'TBA' }}</div>{% if not loop.last %}<br>{% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <div class="badge badge-ghost badge-xs">TBA</div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="text-xs">
                                            {% if subject.class_assignments %}
                                                {% for assignment in subject.class_assignments %}
                                                    <div class="badge badge-ghost badge-xs">{{ assignment.room or 'TBA' }}</div>{% if not loop.last %}<br>{% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <div class="badge badge-ghost badge-xs">TBA</div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="badge {% if subject.subject_type == 'Academic' %}badge-primary{% elif subject.subject_type == 'Non-Academic' %}badge-secondary{% else %}badge-neutral{% endif %} badge-sm">
                                            {{ subject.subject_type or 'Academic' }}
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="flex items-center gap-2">
                                            {% if subject.class_assignments %}
                                                {% for assignment in subject.class_assignments %}
                                                    <div class="flex items-center gap-1">
                                                        <div class="avatar placeholder">
                                                            <div class="w-6 h-6 rounded-full bg-primary text-primary-content">
                                                                <span class="text-xs">
                                                                    {% if assignment.instructor %}
                                                                        {{ assignment.instructor.first_name[0] }}{{ assignment.instructor.last_name[0] }}
                                                                    {% else %}
                                                                        ?
                                                                    {% endif %}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="text-xs">
                                                            {% if assignment.instructor %}
                                                                {{ assignment.instructor.first_name }} {{ assignment.instructor.last_name }}
                                                            {% else %}
                                                                TBA
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    {% if not loop.last %}<br>{% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <div class="flex items-center gap-2">
                                                    <div class="avatar placeholder">
                                                        <div class="w-6 h-6 rounded-full bg-primary text-primary-content">
                                                            <span class="text-xs">
                                                                {% if subject.instructor %}
                                                                    {{ subject.instructor.first_name[0] }}{{ subject.instructor.last_name[0] }}
                                                                {% else %}
                                                                    ?
                                                                {% endif %}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div class="text-xs">
                                                        {% if subject.instructor %}
                                                            {{ subject.instructor.first_name }} {{ subject.instructor.last_name }}
                                                        {% else %}
                                                            TBA
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <button onclick="viewEnrolledStudents({{ subject.id }})" 
                                                class="btn btn-sm btn-ghost hover:btn-primary">
                                            {% if subject.enrolled_count > 0 %}
                                                <div class="badge badge-success badge-sm">
                                                    {{ subject.enrolled_count }}
                                                </div>
                                            {% else %}
                                                <div class="badge badge-warning badge-sm">
                                                    0
                                                </div>
                                            {% endif %}
                                        </button>
                                    </td>
                                    <td class="text-center">
                                        <div class="flex gap-1 justify-center">
                                            <button class="btn btn-ghost btn-xs" onclick="editSubject({{ subject.id }})" title="Edit">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                                </svg>
                                            </button>
                                            <button class="btn btn-ghost btn-xs" onclick="viewDetails({{ subject.id }})" title="View Details">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                                    <circle cx="12" cy="12" r="3"/>
                                                </svg>
                                            </button>
                                            <button class="btn btn-ghost btn-xs text-error" onclick="deleteSubject({{ subject.id }})" title="Delete">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M3 6h18"/>
                                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="12" class="text-center py-12">
                                        <div class="p-4 bg-base-200 rounded-full w-fit mx-auto mb-4">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                                <line x1="1" y1="1" x2="23" y2="23"/>
                                            </svg>
                                        </div>
                                        <h3 class="text-xl font-bold mb-2">No Subjects Found</h3>
                                        <p class="opacity-60">No subject offerings are currently available.</p>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                {% if subjects %}
                <div class="flex justify-between items-center mt-6">
                    <div class="text-sm opacity-60">
                        Showing <span id="showingStart">1</span>-<span id="showingEnd">{{ subjects|length }}</span> of {{ subjects|length }} subjects
                    </div>
                    <div class="join">
                        <button class="join-item btn btn-sm">«</button>
                        <button class="join-item btn btn-sm btn-active">1</button>
                        <button class="join-item btn btn-sm">2</button>
                        <button class="join-item btn btn-sm">3</button>
                        <button class="join-item btn btn-sm">»</button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<style>
/* Custom table styling for better layout */
.table th {
    font-weight: 600;
    font-size: 0.875rem;
    padding: 0.75rem 0.5rem;
    white-space: nowrap;
}

.table td {
    padding: 0.75rem 0.5rem;
    vertical-align: middle;
}

.table tbody tr:hover {
    background-color: hsl(var(--b2) / 0.5);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .table th, .table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.75rem;
    }
    
    .badge {
        font-size: 0.625rem;
        padding: 0.25rem 0.5rem;
    }
}

/* Compact layout for better space utilization */
.table-compact th,
.table-compact td {
    padding: 0.5rem 0.25rem;
}

/* Better badge styling */
.badge-xs {
    font-size: 0.625rem;
    padding: 0.125rem 0.375rem;
    min-height: 1.25rem;
}

.badge-sm {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    min-height: 1.5rem;
}
</style>

<script>
// Action Button Functions
function enlistProctoring() {
    // TODO: Implement proctoring enlistment
    console.log('Enlist Proctoring clicked');
}

function enlistGESubject() {
    // TODO: Implement GE subject enlistment
    console.log('Enlist GE Subject clicked');
}

function enlistMerged() {
    // TODO: Implement merged enlistment
    console.log('Enlist Merged clicked');
}

function enlistSubject() {
    // TODO: Implement subject enlistment
    console.log('Enlist Subject clicked');
}

function refreshContent() {
    // Reload the page to refresh content
    window.location.reload();
}

// Search and Filter Functions
function searchSubjects() {
    const searchTerm = document.getElementById('searchSubject').value.toLowerCase();
    filterSubjects();
}

function filterSubjects() {
    const searchTerm = document.getElementById('searchSubject').value.toLowerCase();
    const yearFilter = document.getElementById('yearFilter').value;
    const semesterFilter = document.getElementById('semesterFilter').value;
    
    const rows = document.querySelectorAll('#subjectsTableBody tr');
    let visibleCount = 0;
    
    rows.forEach(row => {
        const subjectCode = row.querySelector('td:nth-child(3) div:first-child')?.textContent.toLowerCase() || '';
        const subjectName = row.querySelector('td:nth-child(3) div:last-child')?.textContent.toLowerCase() || '';
        const section = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
        
        const matchesSearch = subjectCode.includes(searchTerm) || 
                            subjectName.includes(searchTerm) || 
                            section.includes(searchTerm);
        
        // TODO: Add year and semester filtering logic
        const matchesYear = !yearFilter || true; // Placeholder
        const matchesSemester = !semesterFilter || true; // Placeholder
        
        if (matchesSearch && matchesYear && matchesSemester) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });
    
    // Update showing count
    document.getElementById('showingEnd').textContent = visibleCount;
}

// Table Functions
function toggleSelectAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.subject-checkbox');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

function deleteSelected() {
    const selectedCheckboxes = document.querySelectorAll('.subject-checkbox:checked');
    
    if (selectedCheckboxes.length === 0) {
        alert('Please select subjects to delete.');
        return;
    }
    
    if (confirm(`Are you sure you want to delete ${selectedCheckboxes.length} selected subject(s)?`)) {
        // TODO: Implement bulk delete
        console.log('Deleting selected subjects:', Array.from(selectedCheckboxes).map(cb => cb.value));
    }
}

function editSubject(subjectId) {
    // TODO: Implement edit subject
    console.log('Edit subject:', subjectId);
}

function viewDetails(subjectId) {
    // TODO: Implement view details
    console.log('View details for subject:', subjectId);
}

function deleteSubject(subjectId) {
    if (confirm('Are you sure you want to delete this subject?')) {
        // TODO: Implement delete subject
        console.log('Delete subject:', subjectId);
    }
}

// View Enrolled Students
async function viewEnrolledStudents(subjectId) {
    try {
        const response = await fetch(`/api/subject/${subjectId}/enrolled-students`);
        const data = await response.json();
        
        if (data.status === 'success') {
            showEnrolledModal(data);
        } else {
            alert(data.message || 'Error loading enrolled students');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while loading student data');
    }
}

function showEnrolledModal(data) {
    const modal = document.createElement('div');
    modal.className = 'modal modal-open';
    modal.innerHTML = `
        <div class="modal-box max-w-4xl">
            <h3 class="font-bold text-lg mb-2">${data.subject.code} - ${data.subject.name}</h3>
            <p class="text-sm opacity-60 mb-4">Academic Year 2025-2026 • Semester ${data.subject.semester}</p>
            
            <div class="divider"></div>
            
            <div class="mb-4">
                <p class="font-semibold">Enrolled Students: <span class="badge badge-success">${data.total_count}</span></p>
            </div>
            
            ${data.students.length > 0 ? `
                <div class="overflow-x-auto max-h-96">
                    <table class="table table-zebra table-sm">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Year</th>
                                <th>Section</th>
                                <th>Status</th>
                                <th>Grade</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.students.map(student => `
                                <tr>
                                    <td>${student.student_id}</td>
                                    <td>${student.name}</td>
                                    <td>Year ${student.year_level}</td>
                                    <td>${student.section}</td>
                                    <td><span class="badge badge-sm ${student.enrollment_status === 'Active' ? 'badge-success' : 'badge-warning'}">${student.enrollment_status}</span></td>
                                    <td>${student.final_average !== 'N/A' ? student.final_average.toFixed(2) : 'No grade'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            ` : `
                <div class="text-center py-8">
                    <p class="opacity-60">No students enrolled yet</p>
                </div>
            `}
            
            <div class="modal-action">
                <button class="btn" onclick="this.closest('.modal').remove()">Close</button>
            </div>
        </div>
        <div class="modal-backdrop" onclick="this.closest('.modal').remove()"></div>
    `;
    document.body.appendChild(modal);
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Any initialization code here
});
</script>
{% endblock %}
